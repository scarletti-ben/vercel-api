<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSA Encrypt/Decrypt Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h3 {
            color: #333;
            margin-top: 30px;
            margin-bottom: 10px;
        }

        textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-family: monospace;
            font-size: 14px;
            resize: vertical;
            box-sizing: border-box;
        }

        pre {
            background: #f8f8f8;
            border: 2px solid #ddd;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            word-wrap: break-word;
            white-space: pre-wrap;
            min-height: 50px;
            max-height: 200px;
            overflow-y: auto;
        }

        button {
            background: #007cba;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: background-color 0.3s;
        }

        button:hover {
            background: #005a85;
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .error {
            color: #d32f2f;
            background: #ffebee;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }

        .success {
            color: #388e3c;
            background: #e8f5e8;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }

        .key-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            font-size: 14px;
            color: #1565c0;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>RSA Encrypt/Decrypt Tool</h1>

        <div class="key-info">
            <strong>Note:</strong> This demo uses a pre-generated 2048-bit RSA key pair. In production, keys should be
            generated securely and private keys should never be exposed in client-side code.
        </div>

        <h3>Input Text</h3>
        <textarea id="input" rows="4" placeholder="Enter plaintext to encrypt...">Hello, RSA encryption!</textarea>
        <br>
        <button onclick="encrypt()" id="encryptBtn">ðŸ”’ Encrypt</button>
        <button onclick="generateNewKeys()" id="generateBtn">ðŸ”‘ Generate New Keys</button>

        <h3>Encrypted Data (Base64)</h3>
        <pre id="encrypted"></pre>
        <button onclick="decrypt()" id="decryptBtn" disabled>ðŸ”“ Decrypt</button>
        <button onclick="copyToClipboard('encrypted')" id="copyEncBtn" disabled>ðŸ“‹ Copy Encrypted</button>

        <h3>Decrypted Text</h3>
        <pre id="decrypted"></pre>

        <div id="status"></div>
    </div>

    <script>
        // Default RSA key pair (2048-bit)
        let publicKeyBase64 = "MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAt9lWvcNEYSkxRq5V1lccfbEw/lTYHh1m3vP8lgmda3l14+AGWTRgS6QHM6foCYK754Jf4mxXG3atQCwz9SXPqy8YgBsV3U6XQPUqKBGx0d8w9NPgaPnH9NO2UTi9HbY1yOBU7XokZn68dxqWQvpxTZ2a00ZDPOlMrxS6qH2ii/VWpXMx242qD0yFwk0MTMzlgsQXjtv2onFP+RwbUpfxIC0AWesm8Skj+7j51GN/Kh6bI6sWezt/feBNCfn075koOBIBiWh+PFQukM7fGaPvn9TIRhkSvoc5kwRyxnaqUlGNykPKSy7+uBoTOO4+4WmRA6HwKJ6sMXaUOxiNciq00wIDAQAB";
        let privateKeyBase64 = "MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQC32Va9w0RhKTFGrlXWVxx9sTD+VNgeHWbe8/yWCZ1reXXj4AZZNGBLpAczp+gJgrvngl/ibFcbdq1ALDP1Jc+rLxiAGxXdTpdA9SooEbHR3zD00+Bo+cf007ZROL0dtjXI4FTteiRmfrx3GpZC+nFNnZrTRkM86UyvFLqofaKL9ValczHbjaoPTIXCTQxMzOWCxBeO2/aicU/5HBtSl/EgLQBZ6ybxKSP7uPnUY38qHpsjqxZ7O3994E0J+fTvmSg4EgGJaH48VC6Qzt8Zo++f1MhGGRK+hzmTBHLGdqpSUY3KQ8pLLv64GhM47j7haZEDofAonqwxdpQ7GI1yKrTTAgMBAAECggEAUa60/MOsdlSkaYhcZ8o1RNz8bQtKJ/sdMPKLJygnclA5IiDvASQlooXCk19G1y7oCGBi9Ij5HKEaMXhSL1l4zlAy3Pvrt3NK/VfPvpS6AgpdSHF4c3uCrRKBHs4MLA7AD7sn0IjjckxdtLcxyplVzMu4taSyi/YFlYYqtmB3XyHEbTy3JK87kwFS3bGAVByWD/8qW3QVnh84i4Lf9i0dzzko4um2pPFrIDnuox15XbTP4iqvoIMYSO2j2EkSDX5+ygcsE9FWA6z7IZiIKFMyUFb5+oivZGfNo+XcmFu30ZHBFtyjRcgZ6o2WNEEbNkBGgrHbVnlftl3S2t8qa7z50QKBgQDwbNbSKI7XRRLsDsHZjsbkJaLOBiHRLY3/lFgRCERaCVhUi8Mz27tuAwZD5O5ALud6XqOrwocKEK/V33rrjPYSkY1heAueVXbFk763Mffk+377Rw1BtwhwaVghuKAvHUAfpQQs8RtF9pmaQxcGEaOhXQrKm+Ju+xbdz3BF3BMjgwKBgQDDwkCOVkkFWbXzXtR3Qc6USjrNhJvN+8jSh7yMt/qtXFKcUm9GGtbm07/VeeQQgoJH6oItLi+CJxZWeCbpbirTWr2Po99yDy9Tl7U6J2khDWWFu6DAxsshYkw4c8PC+lvulPYqWEsa3TEuDv8F/+1IQsSDTwktCreRl/taMgFYcQKBgQDG9LpclTWHTODYuWmPOIi8Gaz9IrPvXuxIGKE8DwRJIbyX0kSJ8IbNBfG0U4kZUfc6G4EDzOlk2eQ4b0RQEok7WnmNtAKhVwX/gEDtZotGURyGogiFXgq8w2AsH5VnB6SdyzeGXUt9fRElR+mQmx42lUEt4wvhXSVSDqxRE0o/MwKBgBQAPOhOGJfbWqPLBJpKtvifvPJSojihiRs5kyItigc8b5RZN9VJ2Lss12TQV2T4cKc4ZqSHG4OIytd63z7qaqW9l7CdZa8ZrhQ0Y+fVLwCZhc3sJbiMlySKDo+WBGJfghUWUzBwZPwRrXyvO485Xt0LNVjVMnLPrYHKrXvBsDGBAoGAHRK+FuJ3YGrz3Eo1W7VvgPxZjTaGxTVuaIHUwEjwxhKX+FsSUNwLzGOGbeN7Oh/bactLVFyI3XrQURa5sASzzffgbRi3fpQcN+rBqC1BKkkKArVY1BYi3Qi2LrEz920ffHVNqGyTGKTNV6RNCJIRCBJOOSu7RtJKOfbnghnirPw=";

        let publicKey, privateKey;

        // Import RSA key from base64
        async function importKey(base64, type) {
            try {
                const binaryString = atob(base64);
                const binary = new Uint8Array(binaryString.length);
                for (let i = 0; i < binaryString.length; i++) {
                    binary[i] = binaryString.charCodeAt(i);
                }

                return await crypto.subtle.importKey(
                    type === "public" ? "spki" : "pkcs8",
                    binary.buffer,
                    {
                        name: "RSA-OAEP",
                        hash: "SHA-256"
                    },
                    false,
                    [type === "public" ? "encrypt" : "decrypt"]
                );
            } catch (error) {
                throw new Error(`Failed to import ${type} key: ${error.message}`);
            }
        }

        // Show status messages
        function showStatus(message, isError = false) {
            const statusDiv = document.getElementById("status");
            statusDiv.innerHTML = `<div class="${isError ? 'error' : 'success'}">${message}</div>`;
            setTimeout(() => statusDiv.innerHTML = "", 5000);
        }

        // Encrypt function
        async function encrypt() {
            const input = document.getElementById("input").value.trim();

            if (!input) {
                showStatus("Please enter some text to encrypt.", true);
                return;
            }

            try {
                document.getElementById("encryptBtn").disabled = true;

                // Import public key if not already done
                if (!publicKey) {
                    publicKey = await importKey(publicKeyBase64, "public");
                }

                // Convert input to bytes
                const inputBytes = new TextEncoder().encode(input);

                // Check input size (RSA-OAEP with SHA-256 can encrypt max ~190 bytes for 2048-bit key)
                if (inputBytes.length > 190) {
                    showStatus("Input too long. RSA can encrypt maximum ~190 bytes. Consider using hybrid encryption for larger data.", true);
                    return;
                }

                // Encrypt
                const encryptedBuffer = await crypto.subtle.encrypt(
                    { name: "RSA-OAEP" },
                    publicKey,
                    inputBytes
                );

                // Convert to base64
                const encryptedArray = new Uint8Array(encryptedBuffer);
                const encryptedBase64 = btoa(String.fromCharCode(...encryptedArray));

                // Display result
                document.getElementById("encrypted").textContent = encryptedBase64;
                document.getElementById("decrypted").textContent = "";

                // Enable decrypt button
                document.getElementById("decryptBtn").disabled = false;
                document.getElementById("copyEncBtn").disabled = false;

                showStatus("Text encrypted successfully!");

            } catch (error) {
                showStatus(`Encryption failed: ${error.message}`, true);
            } finally {
                document.getElementById("encryptBtn").disabled = false;
            }
        }

        // Decrypt function
        async function decrypt() {
            const encryptedText = document.getElementById("encrypted").textContent.trim();

            if (!encryptedText) {
                showStatus("No encrypted data to decrypt.", true);
                return;
            }

            try {
                document.getElementById("decryptBtn").disabled = true;

                // Import private key if not already done
                if (!privateKey) {
                    privateKey = await importKey(privateKeyBase64, "private");
                }

                // Convert base64 to binary
                const encryptedBinary = atob(encryptedText);
                const encryptedArray = new Uint8Array(encryptedBinary.length);
                for (let i = 0; i < encryptedBinary.length; i++) {
                    encryptedArray[i] = encryptedBinary.charCodeAt(i);
                }

                // Decrypt
                const decryptedBuffer = await crypto.subtle.decrypt(
                    { name: "RSA-OAEP" },
                    privateKey,
                    encryptedArray.buffer
                );

                // Convert back to text
                const decryptedText = new TextDecoder().decode(decryptedBuffer);
                document.getElementById("decrypted").textContent = decryptedText;

                showStatus("Data decrypted successfully!");

            } catch (error) {
                showStatus(`Decryption failed: ${error.message}`, true);
            } finally {
                document.getElementById("decryptBtn").disabled = false;
            }
        }

        // Generate new RSA key pair
        async function generateNewKeys() {
            try {
                document.getElementById("generateBtn").disabled = true;
                showStatus("Generating new RSA key pair... This may take a moment.");

                const keyPair = await crypto.subtle.generateKey(
                    {
                        name: "RSA-OAEP",
                        modulusLength: 2048,
                        publicExponent: new Uint8Array([1, 0, 1]),
                        hash: "SHA-256",
                    },
                    true,
                    ["encrypt", "decrypt"]
                );

                // Export keys to base64
                const publicKeyBuffer = await crypto.subtle.exportKey("spki", keyPair.publicKey);
                const privateKeyBuffer = await crypto.subtle.exportKey("pkcs8", keyPair.privateKey);

                publicKeyBase64 = btoa(String.fromCharCode(...new Uint8Array(publicKeyBuffer)));
                privateKeyBase64 = btoa(String.fromCharCode(...new Uint8Array(privateKeyBuffer)));

                // Update stored keys
                publicKey = keyPair.publicKey;
                privateKey = keyPair.privateKey;

                // Clear previous results
                document.getElementById("encrypted").textContent = "";
                document.getElementById("decrypted").textContent = "";
                document.getElementById("decryptBtn").disabled = true;
                document.getElementById("copyEncBtn").disabled = true;

                showStatus("New RSA key pair generated successfully!");

            } catch (error) {
                showStatus(`Key generation failed: ${error.message}`, true);
            } finally {
                document.getElementById("generateBtn").disabled = false;
            }
        }

        // Copy to clipboard
        async function copyToClipboard(elementId) {
            const text = document.getElementById(elementId).textContent;
            if (!text) return;

            try {
                await navigator.clipboard.writeText(text);
                showStatus("Copied to clipboard!");
            } catch (error) {
                showStatus("Failed to copy to clipboard.", true);
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function () {
            // Pre-import keys for better performance
            importKey(publicKeyBase64, "public").then(key => publicKey = key);
            importKey(privateKeyBase64, "private").then(key => privateKey = key);
        });
    </script>
</body>

</html>